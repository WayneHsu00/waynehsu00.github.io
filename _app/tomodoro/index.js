function setTime(){let e=config[roundInfo.current]-roundInfo.t;if(e<0)return void nextRound();let t=Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0");timediv.innerText=t,document.title=`${t} ${fullname[roundInfo.current]} - Tomodoro`,progress.style.strokeDashoffset=roundInfo.t/config[roundInfo.current]*100,pipActive&&loop()}function nextRound(){let e=fullname[roundInfo.current],t="Begin ";"focus"===roundInfo.current?("noise"===audioType&&fadeOut(),focusEnd(roundInfo.t),e+=" Round",roundInfo.focusNum>=config.longGap?(roundInfo.current="long",roundInfo.focusNum=0):roundInfo.current="short",t+="a "+Math.floor(config[roundInfo.current]/60)+" minute "+fullname[roundInfo.current]):(roundInfo.current="focus",roundInfo.focusNum++,roundnoDiv.innerText=roundInfo.focusNum+"/"+config.longGap,t+="focusing for "+Math.floor(config.focus/60)+" minutes"),timer.className="t-"+roundInfo.current,roundInfo.t=0,setTime(),roundInfo.running&&("focus"===roundInfo.current&&"noise"===audioType&&fadeIn(),timerWorker.postMessage({type:"start",maxDuration:config[roundInfo.current]})),notify(`${e} Complete`,t)}function pauseplay(){if("none"===roundInfo.current)return nextRound(),void(pauseplaybtn.className="playing");roundInfo.running?("focus"===roundInfo.current&&"noise"===audioType&&fadeOut(),timerWorker.postMessage({type:"stop"}),roundInfo.running=!1,pauseplaybtn.title="Start Timer",pauseplaybtn.className="paused"):("focus"===roundInfo.current&&"noise"===audioType&&fadeIn(),timerWorker.postMessage({type:"start",t:roundInfo.t,maxDuration:config[roundInfo.current]}),roundInfo.running=!0,pauseplaybtn.title="Pause Timer",pauseplaybtn.className="playing")}function setNotif(e){"disabled"===e?notificationEnabled=!1:"silent"===e?(notificationEnabled=!0,notificationSilent=!0):(notificationEnabled=!0,notificationSilent=!1),notifSelect.value=e}function notify(e,t){notificationEnabled&&"Notification"in window&&("granted"===Notification.permission?(notification&&notification.close(),notification=new Notification(e,{body:t,icon:"./icons/icon192.png",silent:notificationSilent})):"denied"!==Notification.permission&&Notification.requestPermission().then(function(n){"granted"===n&&(notification=new Notification(e,{body:t,icon:"./icons/icon192.png",silent:notificationSilent}))}))}function setup(){"Notification"in window&&"denied"!==Notification.permission&&"granted"!==Notification.permission&&Notification.requestPermission(),setTime(),roundnoDiv.innerText=roundInfo.focusNum+"/"+config.longGap}function volumeSliderDisplay(){"noise"===audioType?volumeContainer.classList.remove("disabled"):volumeContainer.classList.add("disabled"),volumeValue.textContent=volume,volumeSlider.value=volume}function initNoise(){audioCtx||(audioCtx=new AudioContext);const e=3*audioCtx.sampleRate,t=audioCtx.createBuffer(1,e,audioCtx.sampleRate);let n=t.getChannelData(0);for(let t=0;t<e;t++)n[t]=2*Math.random()-1;(noiseSource=audioCtx.createBufferSource()).buffer=t,(gain=audioCtx.createGain()).gain=volume/100,noiseSource.connect(gain),gain.connect(audioCtx.destination)}function playNoise(){noiseSource.loop=!0,noiseSource.start(),isWhiteNoiseRunning=!0}function stopNoise(){noiseSource.stop(),isWhiteNoiseRunning=!1,isFadingOut=!1}function fadeOut(){isWhiteNoiseRunning&&(isFadingOut=!0,gain.gain.linearRampToValueAtTime(0,audioCtx.currentTime+1),noiseTimeout=setTimeout(stopNoise,1e3))}function fadeIn(){clearTimeout(noiseTimeout),isFadingOut?(gain.gain.setValueAtTime(gain.gain.value,audioCtx.currentTime),gain.gain.linearRampToValueAtTime(volume/100,audioCtx.currentTime+1)):(initNoise(),gain.gain.setValueAtTime(0,audioCtx.currentTime),gain.gain.linearRampToValueAtTime(volume/100,audioCtx.currentTime+1),playNoise(0))}function loadTasks(){if(navigator.storage.persist(),localStorage.getItem("pomo-tasks")&&((tasks=JSON.parse(localStorage.getItem("pomo-tasks")))instanceof Array||(localStorage.removeItem("pomo-tasks"),tasks=["Default Task"])),localStorage.getItem("pomo-records")){JSON.parse(localStorage.getItem("pomo-records")).forEach(e=>saveRecord(e)),localStorage.removeItem("pomo-records")}return localStorage.getItem("pomo-selected-task")&&tasks.includes(localStorage.getItem("pomo-selected-task"))&&(selectedTask=localStorage.getItem("pomo-selected-task"),taskSelect.value=selectedTask),localStorage.getItem("pomo-stat-period")&&(statTimeSelect.value=localStorage.getItem("pomo-stat-period")),new Promise(e=>{let t=indexedDB.open("pomo-db",1);t.onupgradeneeded=(t=>{let n=(db=t.target.result).createObjectStore("records",{keyPath:"d"});n.createIndex("task","n",{unique:!1}),n.transaction.oncomplete=(()=>{e()})}),t.onsuccess=(t=>{db=t.target.result,e()})})}async function getRecords(){let e=[];return new Promise(t=>{if(0===filteredTasks.size)t(e);else if(filteredTasks.size===tasks.length){let e=db.transaction("records","readonly").objectStore("records").index("task").getAll();e.onsuccess=(()=>t(e.result))}else{let n=Array.from(filteredTasks);n.forEach((o,a)=>{let r=db.transaction("records","readonly").objectStore("records").index("task").getAll(IDBKeyRange.only(o));r.onsuccess=(()=>{e.push(...r.result),a===n.length-1&&t(e)})})}})}function saveRecord(e){db.transaction("records","readwrite").objectStore("records").add(e).onsuccess=(()=>console.log("Added new record!"))}function deleteRecords(e){db.transaction("records","readwrite").objectStore("records").index("task").openCursor(IDBKeyRange.only(e)).onsuccess=(e=>{let t=e.target.result;t&&(t["delete"](),t["continue"]())})}function deleteRecord(e){db.transaction("records","readwrite").objectStore("records")["delete"](e)}function saveTasks(){localStorage.setItem("pomo-tasks",JSON.stringify(tasks))}function focusEnd(e){let t=Math.round(e/60);t<=0||tasks.includes(selectedTask)&&saveRecord({t:t,d:Date.now(),n:selectedTask})}function createTaskEl(e){filteredTasks.add(e);let t=document.createElement("option");t.value=t.innerText=e,taskSelect.appendChild(t);let n=document.createElement("div");n.className="task";let o=document.createElement("div");o.className="task-name",o.innerText=e,n.appendChild(o);let a=document.createElement("label");a.className="task-chip";let r=document.createElement("input");r.className="task-checkbox",r.type="checkbox",r.defaultChecked=!0;let s=document.createElement("span");s.className="chip-task-name",s.innerText=e,a.append(r,s),filterContainer.appendChild(a),taskBars[e]=barGenerator(e),timeSpentChart.appendChild(taskBars[e]),pieCards[e]=pieCardGenerator(e),pieCardContainer.appendChild(pieCards[e]),r.addEventListener("change",function(){this.checked?(filteredTasks.add(e),taskBars[e].style.display="flex",pieCards[e].style.display="block",filteredTasks.size===tasks.length&&(allCheckbox.checked=!0)):(filteredTasks["delete"](e),taskBars[e].style.display="none",pieCards[e].style.display="none",filteredTasks.size<tasks.length&&(allCheckbox.checked=!1)),loadStatistics()});let i=document.createElement("button");i.className="task-delete-btn crossbtn",i.title="Delete this task",i.addEventListener("click",()=>{confirm('Are you sure you want to delete the task "'+e+'"? All the data related to this task will be deleted.')&&(tasks.splice(tasks.indexOf(e),1),t.remove(),n.remove(),a.remove(),filteredTasks["delete"](e),0===filteredTasks.size&&(allCheckbox.checked=!1),filteredTasks.size===tasks.length&&(allCheckbox.checked=!0),taskBars[e].remove(),delete taskBars[e],pieCards[e].remove(),delete pieCards[e],selectedTask===e&&tasks.length>0&&(selectedTask=tasks[0],taskSelect.value=selectedTask),noTaskManager(),deleteRecords(e),saveTasks())}),n.appendChild(i),taskContainer.appendChild(n)}function noTaskManager(){0===tasks.length?(taskSelect.style.display="none",noTaskTitle.style.display="block"):(taskSelect.style.display="initial",noTaskTitle.style.display="none")}async function taskInit(){await loadTasks(),taskSelect.innerHTML="",noTaskManager(),tasks.forEach(e=>createTaskEl(e)),allCheckbox.addEventListener("change",function(){this.checked?(document.querySelectorAll(".task-checkbox").forEach(e=>e.checked=!0),tasks.forEach(e=>{filteredTasks.add(e),taskBars[e].style.display="flex",pieCards[e].style.display="block"})):(document.querySelectorAll(".task-checkbox").forEach(e=>e.checked=!1),tasks.forEach(e=>{filteredTasks["delete"](e),taskBars[e].style.display="none",pieCards[e].style.display="none"})),loadStatistics()})}function pieCardGenerator(e){let t=document.createElement("div");t.className="pie-card";let n=document.createElement("div");n.className="pie-card-name",n.innerText=e,t.appendChild(n);let o=document.createElement("div"),a=document.createElement("span");a.innerText="Time Spent: ";let r=document.createElement("span");r.className="pie-card-time";let s=document.createElement("div");s.className="pie-card-time-div";let i=document.createElement("span");i.className="pie-card-time-text",s.append(document.createTextNode("("),i,document.createTextNode(")"));let l=document.createElement("div");l.className="pie-card-rounds";let c=document.createElement("span");return c.className="pie-card-rounds-span",l.append(document.createTextNode("Number of Rounds: "),c),o.append(a,r,s,l),t.appendChild(o),t}function barGenerator(e){let t=document.createElement("div");t.className="task-bar-container";let n=document.createElement("div");n.className="legend",n.innerText=e;let o=document.createElement("div");o.className="bar-container";let a=document.createElement("div");a.className="bar",o.appendChild(a);let r=document.createElement("div");r.className="tooltip",r.innerText=e;let s=document.createElement("div");return s.className="stat-value",a.append(r,s),t.append(n,o),t.dataset.task=e,t}function roundEntryGen(e){let t=document.createElement("div");t.className="round-entry";let n=document.createElement("div");n.className="round-entry-name",n.innerText=e.n;let o=document.createElement("round-entry-duration");o.className="round-entry-duration",o.innerText=hmstrFull(e.t);let a=document.createElement("div");a.className="round-entry-time",a.innerText=format.format(e.d);let r=document.createElement("button");return r.className="entry-delete",r.innerText="Delete",r.addEventListener("click",()=>{confirm("Are you sure you want to delete this record? This cannot be undone.")&&(deleteRecord(e.d),t.remove(),loadStatistics(!1))}),t.append(n,o,a,r),t}async function loadStatistics(e=!0){let t=statTimeSelect.value,n=await getRecords();if("all"!==t)if(0===parseInt(t)){const e=new Date;e.setHours(0,0,0,0);const t=e.getTime(),o=t+864e5;n=n.filter(e=>e.d>=t&&e.d<o&&filteredTasks.has(e.n))}else{let e=Date.now()-24*parseInt(t)*60*60*1e3;n=n.filter(t=>t.d>=e&&filteredTasks.has(t.n))}let o=[],a=0,r=0,s=0,i=0,l=new Array(4).fill(0),c=new Array(7).fill(0),d=new Array(12).fill(0);for(let e of filteredTasks){let t={t:0,task:e,n:0};n.filter(t=>t.n===e).forEach(e=>{t.t+=e.t,i+=e.t;let n=new Date(e.d);l[Math.floor(n.getHours()/6)]+=e.t,c[n.getDay()]+=e.t,d[n.getMonth()]+=e.t,t.n++,r=0===r?e.t:r>e.t?e.t:r,s=s<e.t?e.t:s}),a=a<t.t?t.t:a,o.push(t)}if(statSummaryTotal.innerText=hmstrFull(i),statSummaryRounds.innerText=n.length,statSummaryAverage.innerText=hmstrFull(i/(0===n.length?1:n.length)),statSummaryShortest.innerText=hmstrFull(r),statSummaryLongest.innerText=hmstrFull(s),0===i)remarkDaily.style.display=remarkHourly.style.display=remarkMonthly.style.display="none";else{remarkDaily.style.display=remarkHourly.style.display=remarkMonthly.style.display="block";let e=1,t=0;l.forEach((n,o)=>{n>t&&(t=n,e=o)}),remarkHourly.querySelector(".remark-value").innerText=hourlyFullNames[e];let n=1,o=0;c.forEach((e,t)=>{e>o&&(o=e,n=t)}),remarkDaily.querySelector(".remark-value").innerText=dayNames[n]+"s";let a=1,r=0;d.forEach((e,t)=>{e>r&&(r=e,a=t)}),remarkMonthly.querySelector(".remark-value").innerText=monthNames[a]}pieSVG.innerHTML="";let u=0;o.sort((e,t)=>t.t-e.t).forEach((e,t)=>{taskBars[e.task].querySelector(".stat-value").innerText=hmstr(e.t),taskBars[e.task].querySelector(".bar").style.width=e.t/a*100+"%",taskBars[e.task].style.order=t+1,pieCards[e.task].style.order=t+1,pieCards[e.task].querySelector(".pie-card-time").innerText=`${(e.t/(0===i?1:i)*100).toFixed(2)}%`,pieCards[e.task].querySelector(".pie-card-time-text").innerText=hmstrFull(e.t),pieCards[e.task].querySelector(".pie-card-rounds-span").innerText=e.n;let n=document.createElementNS("http://www.w3.org/2000/svg","path"),o=u/i*Math.PI*2,r=[60+50*Math.sin(o),60-50*Math.cos(o)],s=(u+e.t)/i*Math.PI*2,l=[60+50*Math.sin(s),60-50*Math.cos(s)],c=(o+s)/2;i===e.t?(n.setAttribute("d","M60,10 A50 50 0 1 1 60 110 A50 50 0 1 1 60 10 z"),n.dataset.circle=!0):n.setAttribute("d",`M60,60 L${r.join(",")} A50 50 0 ${s-o>Math.PI?1:0} 1 ${l.join(" ")} L60,60 z`);let d=document.createElementNS("http://www.w3.org/2000/svg","title");d.innerHTML=`${e.task} ${(e.t/(0===i?1:i)*100).toFixed(2)}%`,n.appendChild(d),n.dataset.normal=c,n.dataset.task=e.task,n.addEventListener("pointerenter",pathPointerEnter),n.addEventListener("pointerleave",pathPointerLeave),pieSVG.appendChild(n),u+=e.t});let m=1;l.forEach(e=>m=m<e?e:m),l.forEach((e,t)=>{hourlyBars[t].querySelector(".stat-value").innerText=hmstr(e),hourlyBars[t].style.width=e/m*100+"%"});let f=1;c.forEach(e=>f=f<e?e:f),c.forEach((e,t)=>{dayBars[t].querySelector(".stat-value").innerText=hmstr(e),dayBars[t].style.width=e/f*100+"%"});let p=1;d.forEach(e=>p=p<e?e:p),d.forEach((e,t)=>{monthBars[t].querySelector(".stat-value").innerText=hmstr(e),monthBars[t].style.width=e/p*100+"%"}),e&&(roundEntries.innerHTML="",n.sort((e,t)=>t.d-e.d).forEach(e=>{roundEntries.appendChild(roundEntryGen(e))}))}function pathPointerEnter(e){let t=pieCards[e.target.dataset.task];if(!e.target.dataset.circle){let t=parseFloat(e.target.dataset.normal);e.target.style.transform=`translate(${5*Math.sin(t)}px, ${5*-Math.cos(t)}px)`}pieCardContainer.scrollTo({left:t.offsetLeft,top:t.offsetTop,behavior:"smooth"}),t.classList.add("pie-card-active")}function pathPointerLeave(e){let t=pieCards[e.target.dataset.task];e.target.style.transform="translate(0px, 0px)",t.classList.remove("pie-card-active")}function hmstr(e){let t=Math.floor(e/60),n=e-60*t;return t.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")}function hmstrFull(e){let t=hmstr(e).split(":").map(e=>parseInt(e));return 0===t[0]?t[1]+" Minutes":0===t[1]?t[0]+" Hour"+(1===t[0]?"":"s"):`${t[0]} Hour${t[0]>1?"s":""} & ${t[1]} Minute${t[1]>1?"s":""}`}function setTheme(e="dark",t){if(t||(t=themes[e].defaccent),"custom"!==e){for(let t in themes[e].props)root.style.setProperty(t,themes[e].props[t]);document.getElementById("t-"+theme).removeAttribute("selected"),addColorButtons(e),document.getElementById("t-"+e).setAttribute("selected",!0),setAccent(e,t)}}function addColorButtons(e){colorsDiv.innerHTML="",colorBtns=[];for(let t in accents[e]){let n=document.createElement("button");n.className="color",n.style.backgroundColor=accents[e][t]["--coloraccent"],n.dataset.color=e+"-"+t,n.addEventListener("click",()=>{setAccent(e,t)}),n.title=t,colorBtns.push(n),colorsDiv.appendChild(n)}}function setAccent(e,t){for(let n in accents[e][t])root.style.setProperty(n,accents[e][t][n]);themeMeta.setAttribute("content",accents[e][t]["--bgcolor"]),colorBtns.forEach(n=>{"true"===n.dataset.active&&(n.dataset.active="false"),n.dataset.color===e+"-"+t&&(n.dataset.active="true")}),localStorage.setItem("pomo-theme",e),localStorage.setItem("pomo-theme-accent",t),theme=e,themeAccent=t}function saveConfig(){localStorage.setItem("pomo-config",JSON.stringify(config)),setTime()}function timerInput(e,t){t>180?(config[e]=10800,timerInputs[e].value=180):t<1?(config[e]=60,timerInputs[e].value=1):config[e]=60*t,saveConfig()}function incrementTimer(e){config[e]<10800&&(config[e]+=60,timerInputs[e].value=config[e]/60),saveConfig()}function decrementTimer(e){config[e]>60&&(config[e]-=60,timerInputs[e].value=config[e]/60),saveConfig()}function loop(){ctx.fillStyle=accents[theme][themeAccent]["--bgcolor"],ctx.fillRect(0,0,400,400),ctx.fillStyle=accents[theme][themeAccent]["--color"],ctx.font="80px monospace",ctx.textAlign="center";let e=config[roundInfo.current]-roundInfo.t;if(e<0)return void nextRound();let t=Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0");ctx.fillText(t,200,200,280),ctx.font="32px monospace",ctx.fillText(fullname[roundInfo.current].toUpperCase(),200,260,280),ctx.strokeStyle=accents[theme][themeAccent]["--coloraccent"],ctx.lineWidth=4,ctx.beginPath(),ctx.arc(200,200,180,0,2*Math.PI),ctx.stroke(),ctx.strokeStyle=themes[theme].props["--"+roundInfo.current],ctx.lineWidth=16,ctx.beginPath(),ctx.arc(200,200,180,-Math.PI/2,(1-roundInfo.t/config[roundInfo.current])*Math.PI*2-Math.PI/2),ctx.stroke()}"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js");let timerWorker=new Worker("./worker.js"),root=document.documentElement,mainel=document.getElementById("main"),statisticsDiv=document.getElementById("statistics"),menu=document.getElementById("menu"),manageTasks=document.getElementById("managetasks"),timediv=document.getElementById("time"),timer=document.getElementById("timer"),roundnoDiv=document.getElementById("roundno"),pauseplaybtn=document.getElementById("pauseplay"),progress=document.getElementById("progress"),nextbtn=document.getElementById("next"),menubtn=document.getElementById("menubtn"),taskSelect=document.getElementById("task-select"),volumeContainer=document.getElementById("slider-container"),volumeSlider=document.getElementById("volume-slider"),volumeValue=document.getElementById("volume-value");const timerInputs={focus:document.getElementById("focus-input"),short:document.getElementById("short-input"),long:document.getElementById("long-input"),rounds:document.getElementById("rounds-input")};let colorsDiv=document.getElementById("colors"),pipActive=!1;const fullname={focus:"Focus",short:"Short Break",long:"Long Break"};let viewState="timer",config={focus:1500,short:300,long:900,longGap:4},audioType="",volume=80;const audioTypes=["noise"];let roundInfo={t:0,focusNum:1,current:"focus",running:!1};timerWorker.addEventListener("message",e=>{roundInfo.t=e.data.t,setTime(),e.data.running||(timer.style.setProperty("--progress","0"),nextRound())}),pauseplaybtn.addEventListener("click",pauseplay),nextbtn.addEventListener("click",()=>{nextRound()}),document.getElementById("resetround").addEventListener("click",()=>{roundInfo.running&&pauseplay(),roundInfo.t=0,setTime()}),document.addEventListener("keydown",e=>{if(!e.isComposing&&229!==e.keyCode&&"Space"===e.code){if(document.activeElement===pauseplaybtn||"timer"!==viewState)return;pauseplaybtn.focus(),pauseplay()}});let notification,notificationEnabled=!0,notificationSilent=!1,notifSelect=document.getElementById("notif-select");localStorage.getItem("pomo-notif")&&setNotif(localStorage.getItem("pomo-notif")),notifSelect.addEventListener("change",function(){setNotif(this.value),localStorage.setItem("pomo-notif",this.value)}),setup();let audioCtx,noiseSource,gain,noiseTimeout,audioSelect=document.getElementById("audio-select");if(localStorage.getItem("pomo-audio-type")){let e=localStorage.getItem("pomo-audio-type");audioTypes.includes(e)&&(audioType=e,audioSelect.value=audioType)}else audioSelect.value="disabled";localStorage.getItem("pomo-audio-volume")&&(volume=parseFloat(localStorage.getItem("pomo-audio-volume"))||80),volumeSliderDisplay();let isWhiteNoiseRunning=!1,isFadingOut=!1;audioSelect.addEventListener("change",()=>{"noise"!==(audioType=audioSelect.value)&&isWhiteNoiseRunning?fadeOut():roundInfo.running&&"focus"===roundInfo.current&&"noise"===audioType&&fadeIn(),volumeSliderDisplay(audioType),localStorage.setItem("pomo-audio-type",audioType)}),volumeSlider.addEventListener("input",()=>{volume=parseFloat(volumeSlider.value),volumeValue.textContent=volume,0===volume?volumeContainer.classList.add("muted"):volumeContainer.classList.remove("muted"),gain&&gain.gain.linearRampToValueAtTime(volume/100,audioCtx.currentTime),localStorage.setItem("pomo-audio-volume",volume)});const animations={out:[{opacity:"1",transform:"translateY(0)"},{opacity:"0",transform:"translateY(50px)"}],"in":[{opacity:"0",transform:"translateY(50px)"},{opacity:"1",transform:"translateY(0)"}],animoptions:{duration:200,fill:"forwards"}};let lastanim;menubtn.addEventListener("click",()=>{if(lastanim&&lastanim.cancel(),"menu"===viewState)mainel.style.display="flex",(lastanim=menu.animate(animations.out,animations.animoptions)).onfinish=(()=>{menu.style.display="none"}),menubtn.title="Open Settings",menubtn.classList.remove("cross"),viewState="timer";else{if("timer"!==viewState)return;menu.style.display="flex",menu.scroll({top:0}),(lastanim=menu.animate(animations["in"],animations.animoptions)).onfinish=(()=>mainel.style.display="none"),menubtn.classList.add("cross"),menubtn.title="Close Settings",viewState="menu"}}),document.getElementById("managetaskbtn").addEventListener("click",function(){lastanim&&lastanim.cancel(),"timer"===viewState&&(manageTasks.style.display="flex",manageTasks.scroll({top:0}),(lastanim=manageTasks.animate(animations["in"],animations.animoptions)).onfinish=(()=>mainel.style.display="none"),viewState="tasks")}),document.getElementById("closetasks").addEventListener("click",function(){lastanim&&lastanim.cancel(),"tasks"===viewState&&(mainel.style.display="flex",(lastanim=manageTasks.animate(animations.out,animations.animoptions)).onfinish=(()=>{manageTasks.style.display="none"}),viewState="timer")}),document.getElementById("statbtn").addEventListener("click",function(){lastanim&&lastanim.cancel(),"timer"===viewState&&(statisticsDiv.style.display="flex",statisticsDiv.scroll({top:0}),(lastanim=statisticsDiv.animate(animations["in"],animations.animoptions)).onfinish=(()=>mainel.style.display="none"),viewState="statistics",loadStatistics())}),document.getElementById("closestats").addEventListener("click",function(){lastanim&&lastanim.cancel(),"statistics"===viewState&&(mainel.style.display="flex",(lastanim=statisticsDiv.animate(animations.out,animations.animoptions)).onfinish=(()=>{statisticsDiv.style.display="none"}),viewState="timer")});let db,tasks=["Default Task"],selectedTask="Default Task",taskContainer=document.getElementById("task-container"),filterContainer=document.getElementById("filters"),filteredTasks=new Set,statTimeSelect=document.getElementById("stat-time-select");document.getElementById("create-backup").addEventListener("click",()=>{let e=db.transaction("records","readonly").objectStore("records").index("task").getAll();e.onsuccess=(()=>{let t=e.result,n=new Blob([JSON.stringify(t)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="tomodorobackup.json",a.click(),setTimeout(()=>URL.revokeObjectURL(o),1e3)})}),document.getElementById("backup-restore").addEventListener("change",function(){let e=this.files;if(0!==e.length){e[0].text().then(e=>{try{let n=JSON.parse(e).map(e=>(tasks.includes(e.n)||(tasks.push(e.n),createTaskEl(e.n),tasks.includes(selectedTask)||(selectedTask=e.n,taskSelect.value=e.n)),{t:e.t,d:e.d,n:e.n}));saveTasks(),noTaskManager(),console.log(n,tasks);let o=db.transaction("records","readwrite");o.oncomplete=(()=>alert("Backup restored successfully!"));let a=o.objectStore("records");n.forEach(e=>a.add(e))}catch(t){console.log(t),alert("An error occured! Make sure that you are restoring a valid backup file.")}})}});let allCheckbox=document.getElementById("all"),pieCardContainer=document.getElementById("pie-card-container"),timeSpentChart=document.getElementById("timespent"),timeSixHourlyChart=document.getElementById("timesixhourly"),timeDailyChart=document.getElementById("timedaily"),timeMonthlyChart=document.getElementById("timemonthly"),timeYearlyChart=document.getElementById("timeyearly");statTimeSelect.addEventListener("change",()=>{localStorage.setItem("pomo-stat-period",statTimeSelect.value),loadStatistics()});let taskBars={},pieCards={},noTaskTitle=document.getElementById("no-task-title");taskInit(),document.getElementById("newtask").addEventListener("submit",function(e){e.preventDefault();let t=new FormData(this).get("taskname").trim();if(""===t)return alert("Please Enter a Valid Name!"),void this.reset();tasks.includes(t)?alert("Task already exists!"):(tasks.push(t),createTaskEl(t),tasks.includes(selectedTask)||(selectedTask=t,taskSelect.value=t),saveTasks(),noTaskManager(),this.reset())}),taskSelect.addEventListener("change",function(){selectedTask=this.value,localStorage.setItem("pomo-selected-task",selectedTask)});let format=new Intl.DateTimeFormat(undefined,{dateStyle:"full",timeStyle:"short"}),hourlyNames=["0-6","6-12","12-18","18-24"],hourlyFullNames=["00:00 - 00:06","06:00 - 12:00","12:00 - 18:00","18:00 - 24:00"],hourlyBars=hourlyNames.map(e=>document.getElementById("hourly-"+e)),dayNames=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],dayBars=dayNames.map(e=>document.getElementById("day-"+e)),monthNames=["january","february","march","april","may","june","july","august","september","october","november","december"],monthBars=monthNames.map(e=>document.getElementById("month-"+e)),pieSVG=document.querySelector("#pie svg"),statSummaryTotal=document.getElementById("stat-summary-total"),statSummaryRounds=document.getElementById("stat-summary-rounds"),statSummaryAverage=document.getElementById("stat-summary-average"),statSummaryShortest=document.getElementById("stat-summary-shortest"),statSummaryLongest=document.getElementById("stat-summary-longest"),remarkHourly=document.getElementById("remark-hourly"),remarkMonthly=document.getElementById("remark-monthly"),remarkDaily=document.getElementById("remark-daily"),roundEntries=document.getElementById("round-entries");const themes={dark:{props:{"color-scheme":"dark","--focus":"#d64f4f","--short":"#26baba","--long":"#5fbbe6"},defaccent:"lavender"},light:{props:{"color-scheme":"light","--focus":"#d64f4f","--short":"#26baba","--long":"#5fbbe6"},defaccent:"red"},black:{props:{"color-scheme":"dark","--focus":"#d64f4f","--short":"#26baba","--long":"#5fbbe6"},defaccent:"lavender"},white:{props:{"color-scheme":"light","--focus":"#d64f4f","--short":"#26baba","--long":"#5fbbe6"},defaccent:"red"}},accents={dark:{red:{"--bgcolor":"#252222","--bgcolor2":"#403333","--color":"#ffeeee","--coloraccent":"#ffaaaa"},violet:{"--bgcolor":"#252225","--bgcolor2":"#3a2a3a","--color":"#ffeeff","--coloraccent":"#ee82ee"},blue:{"--bgcolor":"#131320","--bgcolor2":"#1d3752","--color":"#eeeeff","--coloraccent":"#9bb2ff"},lavender:{"--bgcolor":"#222230","--bgcolor2":"#333340","--color":"#eeeeff","--coloraccent":"#b2b2ff"},green:{"--bgcolor":"#1d201d","--bgcolor2":"#143814","--color":"#eeffee","--coloraccent":"#8dd48d"},teal:{"--bgcolor":"#111f1f","--bgcolor2":"#334040","--color":"#eeffff","--coloraccent":"#00aaaa"},grey:{"--bgcolor":"#222222","--bgcolor2":"#444444","--color":"#dddddd","--coloraccent":"#aaaaaa"}},black:{red:{"--bgcolor2":"#403333","--color":"#ffeeee","--coloraccent":"#ffaaaa","--bgcolor":"#000000"},violet:{"--bgcolor":"#000000","--bgcolor2":"#312131","--color":"#ffeeff","--coloraccent":"#ee82ee"},blue:{"--bgcolor2":"#1d3752","--color":"#eeeeff","--coloraccent":"#9bb2ff","--bgcolor":"#000000"},lavender:{"--bgcolor2":"#333340","--color":"#eeeeff","--coloraccent":"#b2b2ff","--bgcolor":"#000000"},green:{"--bgcolor2":"#143814","--color":"#eeffee","--coloraccent":"#8dd48d","--bgcolor":"#000000"},teal:{"--bgcolor":"#000000","--bgcolor2":"#303f3f","--color":"#eeffff","--coloraccent":"#00aaaa"},grey:{"--bgcolor2":"#444444","--color":"#dddddd","--coloraccent":"#aaaaaa","--bgcolor":"#000000"}},light:{red:{"--bgcolor":"#fff3f3","--bgcolor2":"#ffd2d2","--color":"#222222","--coloraccent":"#d64f4f"},violet:{"--bgcolor":"#fff3ff","--bgcolor2":"#ffd2ff","--color":"#222222","--coloraccent":"#ee82ee"},blue:{"--bgcolor":"#f3f3ff","--bgcolor2":"#d2d2ff","--color":"#222222","--coloraccent":"#4169e4"},lavender:{"--bgcolor":"#faf1ff","--bgcolor2":"#e2d4ff","--color":"#222222","--coloraccent":"#8b51ff"},teal:{"--bgcolor":"#faffff","--bgcolor2":"#cbebeb","--color":"#222222","--coloraccent":"#008080"},green:{"--bgcolor":"#f3fff3","--bgcolor2":"#cafcc1","--color":"#222222","--coloraccent":"#39743d"},grey:{"--bgcolor":"#ffffff","--bgcolor2":"#dddddd","--color":"#333333","--coloraccent":"#555555"}},white:{red:{"--bgcolor":"#ffffff","--bgcolor2":"#ffd2d2","--color":"#222222","--coloraccent":"#ee7777"},violet:{"--bgcolor":"#ffffff","--bgcolor2":"#ffd2ff","--color":"#222222","--coloraccent":"#ee82ee"},blue:{"--bgcolor":"#ffffff","--bgcolor2":"#d2d2ff","--color":"#222222","--coloraccent":"#4169e4"},lavender:{"--bgcolor":"#ffffff","--bgcolor2":"#e2d4ff","--color":"#222222","--coloraccent":"#8b51ff"},teal:{"--bgcolor":"#ffffff","--bgcolor2":"#cbebeb","--color":"#222222","--coloraccent":"#008080"},green:{"--bgcolor":"#ffffff","--bgcolor2":"#cafcc1","--color":"#222222","--coloraccent":"#39743d"},grey:{"--bgcolor":"#ffffff","--bgcolor2":"#dddddd","--color":"#333333","--coloraccent":"#555555"}}};let theme="dark",themeAccent="lavender",colorBtns=[],themeMeta=document.getElementById("theme-meta");document.getElementById("theme-select").addEventListener("change",function(){setTheme(this.value)}),localStorage.getItem("pomo-theme")&&(theme=localStorage.getItem("pomo-theme"),localStorage.getItem("pomo-theme-accent")&&(themeAccent=localStorage.getItem("pomo-theme-accent"))),setTheme(theme,themeAccent),localStorage.getItem("pomo-config")&&(config=JSON.parse(localStorage.getItem("pomo-config")),setTime()),timerInputs.focus.value=config.focus/60,timerInputs.short.value=config.short/60,timerInputs.long.value=config.long/60,timerInputs.rounds.value=config.longGap,timerInputs.focus.addEventListener("input",function(){timerInput("focus",this.value)}),timerInputs.short.addEventListener("input",function(){timerInput("short",this.value)}),timerInputs.long.addEventListener("input",function(){timerInput("long",this.value)}),timerInputs.rounds.addEventListener("input",function(){this.value>18?(config.longGap=18,this.value=18):this.value<1?(config.longGap=1,this.value=1):config.longGap=parseInt(this.value),saveConfig()}),document.getElementById("focus-inc").addEventListener("click",()=>incrementTimer("focus")),document.getElementById("short-inc").addEventListener("click",()=>incrementTimer("short")),document.getElementById("long-inc").addEventListener("click",()=>incrementTimer("long")),document.getElementById("focus-dec").addEventListener("click",()=>decrementTimer("focus")),document.getElementById("short-dec").addEventListener("click",()=>decrementTimer("short")),document.getElementById("long-dec").addEventListener("click",()=>decrementTimer("long")),document.getElementById("rounds-inc").addEventListener("click",()=>{config.longGap=config.longGap<18?config.longGap+1:18,timerInputs.rounds.value=config.longGap,roundnoDiv.innerText=roundInfo.focusNum+"/"+config.longGap,saveConfig()}),document.getElementById("rounds-dec").addEventListener("click",()=>{config.longGap=config.longGap>1?config.longGap-1:1,timerInputs.rounds.value=config.longGap,roundnoDiv.innerText=roundInfo.focusNum+"/"+config.longGap,saveConfig()});let canvas=document.createElement("canvas");canvas.width=canvas.height=400;let ctx=canvas.getContext("2d");if("documentPictureInPicture"in window){let e=null,t=null;async function enterPiP(){const n=document.querySelector("#timer");(e=n.parentNode).classList.add("pip");const o={initialAspectRatio:n.clientWidth/n.clientHeight,lockAspectRatio:!0,copyStyleSheets:!0};t=await documentPictureInPicture.requestWindow(o),[...document.styleSheets].forEach(e=>{try{const o=[...e.cssRules].map(e=>e.cssText).join(""),a=document.createElement("style");a.textContent=o,t.document.head.appendChild(a)}catch(n){const o=document.createElement("link");o.rel="stylesheet",o.type=e.type,o.media=e.media,o.href=e.href,t.document.head.appendChild(o)}}),t.document.body.append(n),t.addEventListener("unload",onLeavePiP.bind(t),{once:!0})}function onLeavePiP(){if(this!==t)return;const n=t.document.querySelector("#timer");e.append(n),e.classList.remove("pip"),t.close(),t=null,e=null}document.getElementById("popupbtn").addEventListener("click",()=>{t?onLeavePiP.bind(t)():enterPiP()})}else{let e=document.createElement("video");if(document.pictureInPictureEnabled||document.fullscreenEnabled){document.body.appendChild(e),document.body.appendChild(canvas),canvas.id="canvas";let t=canvas.captureStream();e.srcObject=t,e.autoplay=!1,e.controls=!0,e.addEventListener("play",()=>{roundInfo.running||pauseplay()}),e.addEventListener("pause",()=>{roundInfo.running&&pauseplay()}),loop(),e.onenterpictureinpicture=(()=>{pipActive=!0,e.classList.add("pipactive")}),e.onleavepictureinpicture=(()=>{document.fullscreenElement||(pipActive=!1,e.classList.remove("pipactive"))}),e.onfullscreenchange=(()=>{
document.fullscreenElement?(pipActive=!0,e.classList.add("pipactive")):(pipActive=!1,e.classList.remove("pipactive"))}),document.getElementById("popupbtn").addEventListener("click",()=>document.pictureInPictureElement?(document.exitPictureInPicture(),void e.classList.remove("pipactive")):pipActive?(pipActive=!1,void e.classList.remove("pipactive")):(loop(),e.play(),e.classList.add("pipactive"),document.pictureInPictureEnabled&&e.requestPictureInPicture(),void(pipActive=!0)))}else document.getElementById("popupbtn").style.display="none"}let versionNo=1,savedNo=parseInt(localStorage.getItem("pomo-version"));savedNo||localStorage.getItem("pomo-notfirstload")&&localStorage.removeItem("pomo-notfirstload"),savedNo!==versionNo&&(document.getElementById("firstload").style.display="block",mainel.style.display="none",document.getElementById("closeintro").addEventListener("click",()=>{document.getElementById("firstload").style.display="none",localStorage.setItem("pomo-version",versionNo),mainel.style.display="flex"}));